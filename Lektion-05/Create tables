-- Skapa tabellerna...
CREATE TABLE IF NOT EXISTS  Customers(
  Id INTEGER PRIMARY KEY AUTOINCREMENT,
  FirstName TEXT NOT NULL,
  LastName TEXT NOT NULL,
  Email TEXT NOT NULL UNIQUE,
  Phone TEXT
);

CREATE TABLE IF NOT EXISTS PostalAddresses(
  Id INTEGER PRIMARY KEY AUTOINCREMENT,
  PostalCode TEXT NOT NULL,
  City TEXT NOT NULL
)

CREATE TABLE IF NOT EXISTS Addresses(
  Id INTEGER PRIMARY KEY AUTOINCREMENT,
  CustomerId INTEGER  NOT NULL,
  AddressType INTEGER NOT NULL,
  AddressLine TEXT NOT NULL,
  PostalAddressId INTEGER NOT NULL,
  FOREIGN KEY(CustomerId) REFERENCES Customers(Id),
  FOREIGN KEY(AddressType) REFERENCES AddressTypes(Id),
  FOREIGN KEY(PostalAddressId) REFERENCES PostalAddress(Id)
);

CREATE TABLE IF NOT EXISTS AddressTypes(
  Id INTEGER PRIMARY KEY AUTOINCREMENT,
  AddressType TEXT NOT NULL UNIQUE
);

CREATE TABLE IF NOT EXISTS VAT(
  Id INTEGER PRIMARY KEY AUTOINCREMENT, 
  Value FLOAT NOT NULL UNIQUE
);

CREATE TABLE IF NOT EXISTS Suppliers(
  Id INTEGER PRIMARY KEY AUTOINCREMENT,
  Name TEXT NOT NULL UNIQUE,
  Phone TEXT NOT NULL,
  Email TEXT NOT NULL UNIQUE
)

CREATE TABLE IF NOT EXISTS Products(
  Id INTEGER PRIMARY KEY AUTOINCREMENT,
  ItemNumber TEXT NOT NULL UNIQUE,
  Name TEXT NOT NULL,
  Price FLOAT NOT NULL,
  VAT_Id INT NOT NULL,
  SupplierId INT NOT NULL,
  FOREIGN KEY(VAT_Id) REFERENCES VAT(Id),
  FOREIGN KEY(SupplierId) REFERENCES Suppliers(Id)
);

CREATE TABLE IF NOT EXISTS SalesOrders(
  Id INTEGER PRIMARY KEY AUTOINCREMENT,
  OrderDate TEXT DEFAULT(datetime('now')) NOT NULL,
  CustomerId INTEGER NOT NULL,
  FOREIGN KEY(CustomerId) REFERENCES Customers(Id)
);

-- Skapa tabellen OrderItems...
CREATE TABLE IF NOT EXISTS OrderItems(
  OrderId INTEGER,
  ProductId INTEGER,
  Quantity INTEGER NOT NULL,
  Price FLOAT NOT NULL,
  PRIMARY KEY(OrderId,ProductId)
);

-- Skapa tabellen InvoiceTypes...
CREATE TABLE IF NOT EXISTS InvoiceTypes(
  Id INTEGER PRIMARY KEY AUTOINCREMENT,
  InvoiceType TEXT NOT NULL UNIQUE
);

-- Skapa tabellen Invoices...
CREATE TABLE IF NOT EXISTS Invoices(
  Id INTEGER PRIMARY KEY AUTOINCREMENT,
  InvoiceType INTEGER NOT NULL,
  SalesOrderId INTEGER NOT NULL,
  InvoiceNumber INTEGER NOT NULL,
  InvoiceDate TEXT DEFAULT (datetime('now')) NOT NULL,
  DueDate TEXT DEFAULT (datetime('now', '+30 days')) NOT NULL,
  Payed INTEGER DEFAULT 0 NOT NULL,
  FOREIGN KEY(SalesOrderId) REFERENCES SalesOrders(Id),
  FOREIGN KEY(InvoiceType) REFERENCES InvoiceTypes(Id)
);
